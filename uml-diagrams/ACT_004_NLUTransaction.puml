@startuml ACT_004_NLUTransaction
start
:User nhập câu lệnh tự nhiên:
"tôi vừa ăn bún bò 50k";
:Gửi request đến AI Service;
:AI Service gọi Gemini API để phân tích NLU;
:AI Service trích xuất:
amount, category, description, date;
if (AI không hiểu câu lệnh?) then (có)
  :AI Service trả về lỗi "Cannot parse transaction";
  :Yêu cầu user nhập lại hoặc nhập thủ công;
  stop
endif
:AI Service tìm category phù hợp nhất;
if (Category không tìm thấy?) then (có)
  :Đề xuất các category gần nhất;
  :User chọn category thủ công;
endif
:AI Service tính confidence score;
if (Confidence score < 0.5?) then (có)
  :Hiển thị cảnh báo và yêu cầu user xác nhận;
endif
:Hiển thị preview giao dịch cho user xác nhận;
if (User xác nhận?) then (có)
  :Tạo transaction với ai_confidence
  và ai_suggested_category_id;
else (Chỉnh sửa)
  :Cho phép user chỉnh sửa;
  :Tạo transaction với thông tin đã chỉnh sửa;
endif
:Cập nhật cache;
:Kiểm tra budget và tạo notification nếu cần;
:Trả về transaction đã tạo;
stop
@enduml

