@startuml Sequence_AIChat
actor User
participant "Frontend" as Frontend
participant "Backend API" as Backend
participant "AI Handler" as AIHandler
participant "AI Service" as AIService
participant "Chat Service" as ChatService
participant "Database" as DB

User -> Frontend: Gửi tin nhắn: "Tháng này tôi tiêu bao nhiêu cho ăn uống?"
Frontend -> Backend: POST /api/v1/ai/chat
Backend -> AIHandler: ProcessChat(request)
AIHandler -> AIService: ProcessChatMessage(userID, message)
AIService -> ChatService: Phân tích intent
ChatService -> ChatService: Xác định loại câu hỏi
alt Câu hỏi về dữ liệu
    ChatService -> DB: Query transactions
    DB --> ChatService: Transaction data
    ChatService -> AIService: Format data for LLM
end
AIService -> AIService: Gọi LLM với context
AIService -> AIService: Xử lý response
AIService --> AIHandler: AI response
AIHandler --> Backend: Chat response
Backend --> Frontend: Response message
Frontend --> User: Hiển thị câu trả lời

@enduml

