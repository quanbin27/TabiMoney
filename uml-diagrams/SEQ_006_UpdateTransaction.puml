@startuml SEQ_006_UpdateTransaction
actor User
participant "Frontend" as Frontend
participant "Backend API" as Backend
participant "Transaction Handler" as Handler
participant "Transaction Service" as Service
participant "Database" as DB
participant "Cache" as Cache

User -> Frontend: Chọn giao dịch cần cập nhật
User -> Frontend: Chỉnh sửa thông tin
Frontend -> Backend: PUT /api/v1/transactions/:id
Backend -> Handler: Update(id, request)
Handler -> Service: UpdateTransaction(id, userID, request)
Service -> DB: SELECT transaction WHERE id = :id
DB --> Service: Transaction data
Service -> Service: Kiểm tra quyền sở hữu
Service -> DB: UPDATE transactions SET ...
DB --> Service: Transaction updated
Service -> Cache: Xóa cache dashboard
Service --> Handler: Updated transaction
Handler --> Backend: Transaction response
Backend --> Frontend: 200 OK
Frontend --> User: Hiển thị giao dịch đã cập nhật

alt Giao dịch không tồn tại
    DB --> Service: Transaction not found
    Service --> Handler: Error: Transaction not found
    Handler --> Backend: 404 Not Found
    Backend --> Frontend: Error response
    Frontend --> User: Hiển thị lỗi
end

alt Không có quyền
    Service -> Service: Kiểm tra quyền sở hữu
    Service --> Handler: Error: Unauthorized
    Handler --> Backend: 403 Forbidden
    Backend --> Frontend: Error response
    Frontend --> User: Hiển thị lỗi
end
@enduml

