@startuml SEQ_001_Register
actor User
participant "Frontend" as Frontend
participant "Backend API" as Backend
participant "Auth Service" as AuthService
participant "Database" as DB

User -> Frontend: Điền form đăng ký
Frontend -> Backend: POST /api/v1/auth/register
Backend -> AuthService: Register(request)
AuthService -> DB: Kiểm tra email hoặc username đã tồn tại
DB --> AuthService: Không tồn tại
AuthService -> AuthService: Hash password bằng bcrypt
AuthService -> DB: INSERT INTO users
DB --> AuthService: User created
AuthService -> DB: INSERT INTO user_profiles
DB --> AuthService: Profile created
AuthService -> AuthService: Generate JWT tokens
AuthService -> DB: INSERT INTO user_sessions
DB --> AuthService: Session created
AuthService -> DB: UPDATE users SET last_login_at
DB --> AuthService: Updated
AuthService -> Backend: AuthResponse (với tokens)
Backend --> Frontend: 201 Created
Frontend --> User: Đăng ký thành công

alt Email hoặc Username đã tồn tại
    DB --> AuthService: User với email hoặc username đã tồn tại
    AuthService --> Backend: Error: "user with this email or username already exists"
    Backend --> Frontend: 409 Conflict
    Frontend --> User: Hiển thị lỗi
end
@enduml

