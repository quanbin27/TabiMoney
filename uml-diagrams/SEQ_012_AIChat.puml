@startuml SEQ_012_AIChat
actor User
participant "Frontend (Web)" as Frontend
participant "AI Service (FastAPI)" as AIService
participant "Transaction Service" as TxService
participant "Database" as DB
participant "Gemini API" as Gemini

User -> Frontend: Nhập câu hỏi: "Tháng này tôi tiêu bao nhiêu cho ăn uống?"
Frontend -> AIService: POST {AI_SERVICE_URL}/api/v1/chat/process\n(user_id, message)
AIService -> TxService: Yêu cầu dữ liệu context (transactions/budgets/goals)
TxService -> DB: SELECT dữ liệu theo user_id
DB --> TxService: Context data
TxService --> AIService: Kết quả truy vấn

AIService -> Gemini: Prompt + context (intent, entities)
Gemini --> AIService: Natural response + structured entities

alt Intent = add_transaction
    AIService -> DB: INSERT INTO transactions\n(Thông qua Transaction Service)
    DB --> AIService: Transaction created
end

AIService --> Frontend: ChatResponse (response, intent, suggestions)
Frontend --> User: Hiển thị câu trả lời

@enduml

