@startuml ACT_018_BudgetAlert
start
:User tạo giao dịch expense;
:Tính spent_amount cho budget liên quan;
:Tính usage_percentage = (spent_amount / amount) * 100;
if (User tắt notification?) then (có)
  stop
endif
if (usage_percentage >= alert_threshold?) then (có)
  :Kiểm tra đã gửi notification cho budget này
  chưa (trong 24h);
  if (Chưa gửi?) then (có)
    :Tạo notification với type='warning',
    priority='high';
    :Gửi notification qua các channels được bật
    (web, email, telegram);
  endif
endif
if (usage_percentage >= 100?) then (có)
  :Tạo notification với type='error',
  priority='urgent';
  :Gửi notification ngay lập tức;
endif
stop
@enduml

